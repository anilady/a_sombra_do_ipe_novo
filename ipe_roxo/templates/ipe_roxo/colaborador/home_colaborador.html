{% extends 'ipe_roxo/partials/base.html' %}
{% load static %}

{% block title %}Painel do Colaborador{% endblock title %}

{% block content %}
{% include 'ipe_roxo/partials/navbar_colaborador.html' %}

<main class="flex-grow-1 d-flex flex-column py-5 px-5">
  <div class="container-fluid">
    <!-- Boas-vindas -->
    <div class="mb-5 text-center">
      <h2 class="display-4">Bem-vindo(a), {{ request.user.first_name|default:request.user.username }}!</h2>
      <p class="lead">Aqui voc√™ pode acompanhar os plantios realizados e o estado das √°rvores.</p>
    </div>

    <!-- Cart√µes com Gr√°ficos -->
    <div class="row justify-content-center">
      <div class="col-md-6 mb-4">
        <div class="card shadow-sm rounded-lg">
          <div class="card-header text-center">
            <h5 class="mb-0">Distribui√ß√£o das √Årvores</h5>
          </div>
          <div class="card-body">
            <canvas id="graficoPizza" width="400" height="400"></canvas>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card shadow-sm rounded-lg">
          <div class="card-header text-center">
            <h5 class="mb-0">Plantios Mensais</h5>
          </div>
          <div class="card-body">
            <canvas id="graficoLinha" width="600" height="300"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Scripts dos Gr√°ficos -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Gr√°fico de Pizza
  const ctxPizza = document.getElementById('graficoPizza').getContext('2d');
  const pizza = new Chart(ctxPizza, {
    type: 'pie',
    data: {
      labels: ['üå± Vivas', 'üíÄ Mortas', 'üåø Replantadas'],
      datasets: [{
        data: [{{ grafico_pizza.vivas }}, {{ grafico_pizza.mortas }}, {{ grafico_pizza.replantadas }}],
        backgroundColor: ['#198754', '#dc3545', '#ffc107'],
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            font: { size: 14, weight: 'bold' }
          }
        },
        title: {
          display: true,
          text: 'Distribui√ß√£o das √Årvores',
          font: {
            size: 18
          }
        }
      }
    }
  });

  // Gr√°fico de Linha
  const ctxLinha = document.getElementById('graficoLinha').getContext('2d');
  const linha = new Chart(ctxLinha, {
    type: 'line',
    data: {
      labels: {{ grafico_linha.meses|safe }},
      datasets: [{
        label: 'üå≥ Plantios Mensais',
        data: {{ grafico_linha.totais|safe }},
        borderColor: '#198754',
        backgroundColor: 'rgba(25, 135, 84, 0.2)',
        tension: 0.3,
        pointRadius: 6,
        pointBackgroundColor: '#198754',
        fill: true
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Quantidade de Plantios',
            font: { size: 14, weight: 'bold' }
          }
        },
        x: {
          title: {
            display: true,
            text: 'M√™s/Ano',
            font: { size: 14, weight: 'bold' }
          }
        }
      },
      plugins: {
        legend: {
          display: true,
          position: 'top',
          labels: {
            font: { size: 14, weight: 'bold' }
          }
        },
        title: {
          display: true,
          text: 'Plantios Realizados por M√™s',
          font: { size: 18 }
        }
      }
    }
  });
</script>
{% endblock %}
